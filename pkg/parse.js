import{unified as n}from"unified";import t from"remark-parse";import e from"remark-gfm";import r from"@sindresorhus/slugify";import i from"remark-stringify";import o from"strip-final-newline";import a from"debug";import{isMatch as u,parse as f}from"date-fns";import{zonedTimeToUtc as l,formatInTimeZone as h}from"date-fns-tz";function c(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}var d=["yyyy-MM-dd","dd/MM/yyyy","dd/MM/yy","dd-MM-yyyy","dd-MM-yy","dd.MM.yyyy","dd.MM.yy"],m=["HH:mm","HH.mm","hh:mm aaa","hh:mm a..aa","hh:mm aaaa"],s=function n(t){return t.children.map(function(e){var r={};return"list"===e.type?n(t):"listItem"===e.type?(r.checked=e.checked,e.children.map(function(n){if("paragraph"===n.type)return r.text=n.children.map(function(n){return"link"===n.type?(r.link=n.url,"["+n.children[0].value+"]("+n.url+")"):n.value}).filter(function(n){return!!n}).join(""),r}).filter(function(n){return!!n})):void 0}).filter(function(n){return!!n})};function p(n,t,e){if(!n.s){if(e instanceof y){if(!e.s)return void(e.o=p.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(p.bind(null,n,t),p.bind(null,n,2));n.s=t,n.v=e;var r=n.o;r&&r(n)}}var v=function(a){try{var v,M,x,k,w,O,I,j,A,H,S,T,C,U,D;return b("parseMD()"),Promise.resolve(n().use(t).use(e).parse(a)).then(function(t){function a(){for(C in E)(D=(U=E[C]).content.filter(Boolean))&&D.length>0&&(1===D.length&&(U.text=D[0]),U.text=D.join("\n\n")),U.content=D;return E}if(!t)return[];var E={},P=null;v=function(n,t){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,t){if(n){if("string"==typeof n)return c(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(n,t):void 0}}(n))){e&&(n=e);var r=0;return function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.children);var _=function(n,t,e){for(var r;;){var i=n();if(g(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=e();if(o&&o.then){if(!g(o)){r=1;break}o=o.s}if(t){var a=t();if(a&&a.then&&!g(a)){r=2;break}}}var u=new y,f=p.bind(null,u,2);return(0===r?i.then(h):1===r?o.then(l):a.then(c)).then(void 0,f),u;function l(r){o=r;do{if(t&&(a=t())&&a.then&&!g(a))return void a.then(c).then(void 0,f);if(!(i=n())||g(i)&&!i.v)return void p(u,1,o);if(i.then)return void i.then(h).then(void 0,f);g(o=e())&&(o=o.v)}while(!o||!o.then);o.then(l).then(void 0,f)}function h(n){n?(o=e())&&o.then?o.then(l).then(void 0,f):l(o):p(u,1,o)}function c(){(i=n())?i.then?i.then(h).then(void 0,f):h(i):p(u,1,o)}}(function(){return!(M=v()).done},void 0,function(){return x=M.value,Promise.resolve(n().use(e).use(i).stringify(x)).then(function(n){var t,e;(k=o(n)).indexOf("\\_")>-1&&(k=k.replace(/\\_/g,"_")),"heading"===x.type?(P=r(x.children[0].value),E[P]={title:x.children[0].value,heading:x.depth,content:[]}):"paragraph"===x.type&&P?(w=E[P],t=k,e=d.map(function(n){return u(t,n)}),O=e.indexOf(!0)>-1?l(f(t,d[e.indexOf(!0)],new Date),"UTC").toJSON().split("T")[0]:null,I=x.children.filter(function(n){return"image"===n.type}).map(function(n){return{src:n.url,alt:n.alt}}),j=x.children.filter(function(n){return"link"===n.type}).map(function(n){return{src:n.url,alt:n.children[0].value}}),A=function(n){var t=m.map(function(t){return u(n,t)});if(t.indexOf(!0)>-1){var e=l(f(n,m[t.indexOf(!0)],new Date),"UTC");return h(e,"UTC","HH:mm")}return null}(k),H=function(n){var t=!1,e={hours:0,minutes:0},r=new RegExp(/([0-9]+)h([0-9]+)m/),i=new RegExp(/([0-9]+)h/);if(n.match(r)){t=!0;var o=n.match(r),a=o[2];e.hours=parseInt(o[1]),e.minutes=parseInt(a)}else if(n.match(i)){t=!0;var u=n.match(i);e.hours=parseInt(u[1]),e.minutes=0}return t?e:null}(k),O&&(w.date=O),A&&(w.time=A),H&&(w.duration=H),j&&j.length>0&&(w.links=j),I&&I.length>0&&(w.images=I),w.content.push(k)):"list"===x.type?((S=E[P]).text=k,S.list=s(x).flat()):"html"===x.type?E[P].content.push(x.html):"code"===x.type?((T=E[P]).lang=x.lang,T.text=k):(b("unhandled token type"),b(x))})});return _&&_.then?_.then(a):a()})}catch(n){return Promise.reject(n)}},y=/*#__PURE__*/function(){function n(){}return n.prototype.then=function(t,e){var r=new n,i=this.s;if(i){var o=1&i?t:e;if(o){try{p(r,1,o(this.v))}catch(n){p(r,2,n)}return r}return this}return this.o=function(n){try{var i=n.v;1&n.s?p(r,1,t?t(i):i):e?p(r,1,e(i)):p(r,2,i)}catch(n){p(r,2,n)}},r},n}();function g(n){return n instanceof y&&1&n.s}var b=a("body-parser");export{v as default};
//# sourceMappingURL=parse.js.map
