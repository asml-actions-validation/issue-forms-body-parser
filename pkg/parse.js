import{unified as n}from"unified";import t from"remark-parse";import e from"remark-gfm";import r from"@sindresorhus/slugify";import i from"remark-stringify";import o from"strip-final-newline";import{isMatch as a,parse as u}from"date-fns";import{zonedTimeToUtc as f,formatInTimeZone as l}from"date-fns-tz";function c(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}var h=["yyyy-MM-dd","dd/MM/yyyy","dd/MM/yy","dd-MM-yyyy","dd-MM-yy","dd.MM.yyyy","dd.MM.yy"],d=["HH:mm","HH.mm","hh:mm aaa","hh:mm a..aa","hh:mm aaaa"],s=function n(t){return t.children.map(function(e){var r={};return"list"===e.type?n(t):"listItem"===e.type?(r.checked=e.checked,e.children.map(function(n){if("paragraph"===n.type)return r.text=n.children.map(function(n){return"link"===n.type?(r.link=n.url,"["+n.children[0].value+"]("+n.url+")"):n.value}).filter(function(n){return!!n}).join(""),r}).filter(function(n){return!!n})):void 0}).filter(function(n){return!!n})};function m(n,t,e){if(!n.s){if(e instanceof p){if(!e.s)return void(e.o=m.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(m.bind(null,n,t),m.bind(null,n,2));n.s=t,n.v=e;var r=n.o;r&&r(n)}}var v=function(v){try{var g,b,M,x,k,w,O,I,j,A,H,S,T;return Promise.resolve(n().use(t).use(e).parse(v)).then(function(t){function v(){for(H in U)(T=(S=U[H]).content.filter(Boolean))&&T.length>0&&(1===T.length&&(S.text=T[0]),S.text=T.join("\n\n")),S.content=T;return U}if(!t)return[];var U={},C=null;g=function(n,t){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,t){if(n){if("string"==typeof n)return c(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(n,t):void 0}}(n))){e&&(n=e);var r=0;return function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.children);var E=function(n,t,e){for(var r;;){var i=n();if(y(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=e();if(o&&o.then){if(!y(o)){r=1;break}o=o.s}if(t){var a=t();if(a&&a.then&&!y(a)){r=2;break}}}var u=new p,f=m.bind(null,u,2);return(0===r?i.then(c):1===r?o.then(l):a.then(h)).then(void 0,f),u;function l(r){o=r;do{if(t&&(a=t())&&a.then&&!y(a))return void a.then(h).then(void 0,f);if(!(i=n())||y(i)&&!i.v)return void m(u,1,o);if(i.then)return void i.then(c).then(void 0,f);y(o=e())&&(o=o.v)}while(!o||!o.then);o.then(l).then(void 0,f)}function c(n){n?(o=e())&&o.then?o.then(l).then(void 0,f):l(o):m(u,1,o)}function h(){(i=n())?i.then?i.then(c).then(void 0,f):c(i):m(u,1,o)}}(function(){return!(b=g()).done},void 0,function(){return M=b.value,Promise.resolve(n().use(e).use(i).stringify(M)).then(function(n){var t,e;(x=o(n)).indexOf("\\_")>-1&&(x=x.replace(/\\_/g,"_")),"heading"===M.type?(C=r(M.children[0].value),U[C]={title:M.children[0].value,heading:M.depth,content:[]}):"paragraph"===M.type&&C?(k=U[C],t=x,e=h.map(function(n){return a(t,n)}),w=e.indexOf(!0)>-1?f(u(t,h[e.indexOf(!0)],new Date),"UTC").toJSON().split("T")[0]:null,O=function(n){var t=d.map(function(t){return a(n,t)});if(t.indexOf(!0)>-1){var e=f(u(n,d[t.indexOf(!0)],new Date),"UTC");return l(e,"UTC","HH:mm")}return null}(x),I=function(n){var t=!1,e={hours:0,minutes:0},r=new RegExp(/([0-9]+)h([0-9]+)m/),i=new RegExp(/([0-9]+)h/);if(n.match(r)){t=!0;var o=n.match(r),a=o[2];e.hours=parseInt(o[1]),e.minutes=parseInt(a)}else if(n.match(i)){t=!0;var u=n.match(i);e.hours=parseInt(u[1]),e.minutes=0}return t?e:null}(x),w&&(k.date=w),O&&(k.time=O),I&&(k.duration=I),k.content.push(x)):"list"===M.type?((j=U[C]).text=x,j.list=s(M).flat()):"html"===M.type?U[C].content.push(M.html):"code"===M.type?((A=U[C]).lang=M.lang,A.text=x):process.env.DEBUG&&(console.log("unhandled token type"),console.log(M))})});return E&&E.then?E.then(v):v()})}catch(n){return Promise.reject(n)}};const p=/*#__PURE__*/function(){function n(){}return n.prototype.then=function(t,e){const r=new n,i=this.s;if(i){const n=1&i?t:e;if(n){try{m(r,1,n(this.v))}catch(n){m(r,2,n)}return r}return this}return this.o=function(n){try{const i=n.v;1&n.s?m(r,1,t?t(i):i):e?m(r,1,e(i)):m(r,2,i)}catch(n){m(r,2,n)}},r},n}();function y(n){return n instanceof p&&1&n.s}export{v as default};
//# sourceMappingURL=parse.js.map
