var e=require("unified"),n=require("remark-parse"),t=require("remark-gfm"),r=require("@sindresorhus/slugify"),i=require("remark-stringify"),u=require("strip-final-newline"),a=require("debug"),o=require("date-fns"),f=require("date-fns-tz");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=/*#__PURE__*/l(n),d=/*#__PURE__*/l(t),h=/*#__PURE__*/l(r),s=/*#__PURE__*/l(i),v=/*#__PURE__*/l(u),y=/*#__PURE__*/l(a);function m(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var p=["yyyy-MM-dd","dd/MM/yyyy","dd/MM/yy","dd-MM-yyyy","dd-MM-yy","dd.MM.yyyy","dd.MM.yy"],g=["HH:mm","HH.mm","hh:mm aaa","hh:mm a..aa","hh:mm aaaa"],b=function e(n){return n.children.map(function(t){var r={};return"list"===t.type?e(n):"listItem"===t.type?(r.checked=t.checked,t.children.map(function(e){if("paragraph"===e.type)return r.text=e.children.map(function(e){return"link"===e.type?(r.link=e.url,"["+e.children[0].value+"]("+e.url+")"):e.value}).filter(function(e){return!!e}).join(""),r}).filter(function(e){return!!e})):void 0}).filter(function(e){return!!e})};function M(e,n,t){if(!e.s){if(t instanceof x){if(!t.s)return void(t.o=M.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(M.bind(null,e,n),M.bind(null,e,2));e.s=n,e.v=t;var r=e.o;r&&r(e)}}var x=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var r=new e,i=this.s;if(i){var u=1&i?n:t;if(u){try{M(r,1,u(this.v))}catch(e){M(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?M(r,1,n?n(i):i):t?M(r,1,t(i)):M(r,2,i)}catch(e){M(r,2,e)}},r},e}();function k(e){return e instanceof x&&1&e.s}var w=y.default("body-parser");module.exports=function(n){try{var t,r,i,u,a,l,y,T,q,I,O,j,A,H,S;return w("parseMD()"),Promise.resolve(e.unified().use(c.default).use(d.default).parse(n)).then(function(n){function c(){for(A in U)(S=(H=U[A]).content.filter(Boolean))&&S.length>0&&(1===S.length&&(H.text=S[0]),H.text=S.join("\n\n")),H.content=S;return U}if(!n)return[];var U={},C=null;t=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return m(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(e,n):void 0}}(e))){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(n.children);var z=function(e,n,t){for(var r;;){var i=e();if(k(i)&&(i=i.v),!i)return u;if(i.then){r=0;break}var u=t();if(u&&u.then){if(!k(u)){r=1;break}u=u.s}if(n){var a=n();if(a&&a.then&&!k(a)){r=2;break}}}var o=new x,f=M.bind(null,o,2);return(0===r?i.then(c):1===r?u.then(l):a.then(d)).then(void 0,f),o;function l(r){u=r;do{if(n&&(a=n())&&a.then&&!k(a))return void a.then(d).then(void 0,f);if(!(i=e())||k(i)&&!i.v)return void M(o,1,u);if(i.then)return void i.then(c).then(void 0,f);k(u=t())&&(u=u.v)}while(!u||!u.then);u.then(l).then(void 0,f)}function c(e){e?(u=t())&&u.then?u.then(l).then(void 0,f):l(u):M(o,1,u)}function d(){(i=e())?i.then?i.then(c).then(void 0,f):c(i):M(o,1,u)}}(function(){return!(r=t()).done},void 0,function(){return i=r.value,Promise.resolve(e.unified().use(d.default).use(s.default).stringify(i)).then(function(e){var n,t;(u=v.default(e)).indexOf("\\_")>-1&&(u=u.replace(/\\_/g,"_")),"heading"===i.type?(C=h.default(i.children[0].value),U[C]={title:i.children[0].value,heading:i.depth,content:[]}):"paragraph"===i.type&&C?(a=U[C],n=u,t=p.map(function(e){return o.isMatch(n,e)}),l=t.indexOf(!0)>-1?f.zonedTimeToUtc(o.parse(n,p[t.indexOf(!0)],new Date),"UTC").toJSON().split("T")[0]:null,y=i.children.filter(function(e){return"image"===e.type}).map(function(e){return{src:e.url,alt:e.alt}}),T=i.children.filter(function(e){return"link"===e.type}).map(function(e){return{src:e.url,alt:e.children[0].value}}),q=function(e){var n=g.map(function(n){return o.isMatch(e,n)});if(n.indexOf(!0)>-1){var t=f.zonedTimeToUtc(o.parse(e,g[n.indexOf(!0)],new Date),"UTC");return f.formatInTimeZone(t,"UTC","HH:mm")}return null}(u),I=function(e){var n=!1,t={hours:0,minutes:0},r=new RegExp(/([0-9]+)h([0-9]+)m/),i=new RegExp(/([0-9]+)h/);if(e.match(r)){n=!0;var u=e.match(r),a=u[2];t.hours=parseInt(u[1]),t.minutes=parseInt(a)}else if(e.match(i)){n=!0;var o=e.match(i);t.hours=parseInt(o[1]),t.minutes=0}return n?t:null}(u),l&&(a.date=l),q&&(a.time=q),I&&(a.duration=I),T&&T.length>0&&(a.links=T),y&&y.length>0&&(a.images=y),a.content.push(u)):"list"===i.type?((O=U[C]).text=u,O.list=b(i).flat()):"html"===i.type?U[C].content.push(i.html):"code"===i.type?((j=U[C]).lang=i.lang,j.text=u):(w("unhandled token type"),w(i))})});return z&&z.then?z.then(c):c()})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=parse.cjs.map
